# -*- mode: org; coding: utf-8 -*-
#+STARTUP: show2levels
#+TITLE: My Literate Emacs Configuration
#+AUTHOR: Phil Hwang

[[https://melpa.org/#/literate-elisp][file:https://melpa.org/packages/literate-elisp-badge.svg]]
[[https://stable.melpa.org/#/literate-elisp][file:https://stable.melpa.org/packages/literate-elisp-badge.svg]]

* COMMENT How to use it
#+BEGIN_SRC sh
  cd
  git clone https://github.com/bbingju/literate-emacs-configuration.git .emacs.d
#+END_SRC

* First of All

** Speed-up at startup
#+BEGIN_SRC emacs-lisp
  (let* ((normal-gc-cons-threshold (* 20 1024 1024))
         (init-gc-cons-threshold (* 128 1024 1024)))
    (setq gc-cons-threshold init-gc-cons-threshold)
    (add-hook 'emacs-startup-hook
              (lambda () (setq gc-cons-threshold normal-gc-cons-threshold))))
#+END_SRC

** Increase the amount of data which emacs reads from the process

#+begin_src emacs-lisp
  (setq read-process-output-max (* 1024 1024))
#+end_src

** Add load-path

#+BEGIN_SRC emacs-lisp
  (add-to-list 'load-path (expand-file-name "lisp" user-emacs-directory))
#+END_SRC

** ELPA configuration
#+BEGIN_SRC emacs-lisp
  (require 'package)
  (let* ((no-ssl (and (memq system-type '(windows-nt ms-dos))
                      (not (gnutls-available-p))))
         (proto (if no-ssl "http" "https")))
    ;; Comment/uncomment these two lines to enable/disable MELPA and MELPA Stable as desired
    (add-to-list 'package-archives (cons "melpa" (concat proto "://melpa.org/packages/")) t)
    ;; (add-to-list 'package-archives (cons "melpa-stable" (concat proto "://stable.melpa.org/packages/")) t)
    (when (< emacs-major-version 24)
      ;; For important compatibility libraries like cl-lib
      (add-to-list 'package-archives '("gnu" . (concat proto "://elpa.gnu.org/packages/"))))
    )
  (unless package--initialized (package-initialize t))
#+END_SRC

** use-package

íŒ¨í‚¤ì§€ ê´€ë¦¬ì— [[https://github.com/jwiegley/use-package][use-package]]ë¥¼ ì ê·¹ ì´ìš©í•œë‹¤. í•˜ì§€ë§Œ ì•„ì§ë„ ê°œë³„ ì„¤ì •ì— ì˜ë¬¸ìŠ¤ëŸ¬ìš´ ì ì´ ë§ë‹¤.

#+BEGIN_SRC emacs-lisp
  (unless (package-installed-p 'use-package)
    (package-refresh-contents)
    (package-install 'use-package))
#+END_SRC

=use-package= ê°€ í¸í•œ ì´ìœ  ì¤‘ í•˜ë‚˜ëŠ” í•„ìš”í•œ íŒ¨í‚¤ì§€ë¥¼ elpaì—ì„œ ì§ì ‘ ê°€ì ¸ì˜¤ê¸° ë•Œë¬¸ì´ë‹¤. ê·¸ëŸ°ë° ì„¤ì •ë§ˆë‹¤ ~:ensure t~ ë¥¼ ì„¤ì •í•´ì¤˜ì•¼ ìë™ìœ¼ë¡œ ì§„í–‰í•˜ëŠ”ë° ë²ˆê±°ë¡œìš°ë¯€ë¡œ ì „ì—­ë³€ìˆ˜ë¡œ ì„¤ì •í•´ë‘”ë‹¤.

#+begin_src emacs-lisp
  (setq use-package-always-ensure t)
#+end_src

** My own fuctions & macros

#+BEGIN_SRC emacs-lisp
  (defmacro when-linux (&rest body)
    (list 'if (string-match "linux" (prin1-to-string system-type))
          (cons 'progn body)))

  (defmacro when-windows (&rest body)
    (list 'if (string-match "windows" (prin1-to-string system-type))
          (cons 'progn body)))

  (defmacro when-mac (&rest body)
    (list 'if (string-match "darwin" (prin1-to-string system-type))
          (cons 'progn body)))
#+END_SRC

** Sync a path to Environment Variable

GUI ëª¨ë“œë‚˜ ë§¥ í™˜ê²½ì—ì„œ emacsë¥¼ ì‹¤í–‰í•˜ë©´ ì„¤ì •ë˜ì–´ ìˆë˜ =PATH= í™˜ê²½ë³€ìˆ˜ê°€ emacsì— ì ìš©ë˜ì§€ ì•Šì„ ìˆ˜ ìˆë‹¤. [[https://github.com/purcell/exec-path-from-shell][exec-path-from-shell]] íŒ¨í‚¤ì§€ë¥¼ ì´ìš©í•˜ì—¬ ì‹±í¬ë¥¼ ë§ì¶˜ë‹¤.

#+begin_src emacs-lisp
  (use-package exec-path-from-shell
    :if (memq window-system '(darwin mac ns x))
    :ensure t
    :config
    (exec-path-from-shell-initialize))
#+end_src

** Input method & coding system

I need this configuration.

#+BEGIN_SRC emacs-lisp
  (when enable-multibyte-characters
    (set-language-environment "Korean")
    (setq-default file-name-coding-system 'utf-8)
    (setq default-input-method "korean-hangul")
    (prefer-coding-system 'utf-8)
    (set-default-coding-systems 'utf-8))

  (when-windows (set-file-name-coding-system 'euc-kr)
                (global-set-key (kbd "S-SPC") 'toggle-input-method)
                (global-set-key (kbd "<Hangul>") 'toggle-input-method)
                (global-set-key (kbd "<Hangul_Hanja>") 'hangul-to-hanja-conversion))
#+END_SRC

MacOS ì¼ ê²½ìš°, íŒŒì¼ì‹œìŠ¤í…œì—ì„œ í•œê¸€ì´ ì œëŒ€ë¡œ ë‚˜ì˜¤ê²Œ í•˜ê¸° ìœ„í•´ì„œ ì•„ë˜ì™€ ê°™ì´ ì„¤ì •í•œë‹¤.

#+BEGIN_SRC emacs-lisp
  (when-mac (require 'ucs-normalize)
            (set-file-name-coding-system 'utf-8-hfs)
            (setq default-process-coding-system '(utf-8-hfs . utf-8-hfs)))
#+END_SRC

** File-related tweaks
#+begin_src emacs-lisp
  (use-package files
    :ensure nil
    :config
    (setq confirm-kill-processes nil
          make-backup-files nil))
#+end_src

** Automatically refreshes the buffer for changes outside of emacs
Auto refreshes every 3 seconds.

#+begin_src emacs-lisp
  (use-package autorevert
    :ensure nil
    :config
    (global-auto-revert-mode +1)
    (setq auto-revert-interval 3
          auto-revert-check-vc-info t
          auto-revert-non-file-buffers t
          auto-revert-verbose nil))
#+end_src

** Load a custom file
If the file =~/.emacs.d/.custom.el= exist, load it.

#+BEGIN_SRC emacs-lisp
  (setq custom-file (expand-file-name ".custom.el" user-emacs-directory))
  (when (file-exists-p custom-file)
    (load custom-file))
#+END_SRC

** Search and Selection Interface

Helmì´ ìœ ì§€ë³´ìˆ˜ë˜ì§€ ì•ŠëŠ” ê²ƒ ê°™ì•„ ë‹¤ë¥¸ ëŒ€ì•ˆì„ ì¨ë³¼ ê³„íšì´ë‹¤. ìš°ì„  minibufer completion systemìœ¼ë¡œ [[https://github.com/minad/vertico][vertico.el]]ì„ ì‚¬ìš©í•œë‹¤.

#+begin_src elisp
  (use-package vertico
    :init
    (vertico-mode))
#+end_src

completion ì‹œìŠ¤í…œ ì´ìš© ì‹œ ì°¾ê³ í•˜ í•˜ëŠ” ì•„ì´í…œì˜ ì´ë¦„ì„ ì²˜ìŒë¶€í„° ì…ë ¥í•˜ì§€ ì•Šì•„ë„ ë˜ê²Œ [[https://github.com/oantolin/orderless][Orderless]]ë¥¼ ì‚¬ìš©í•œë‹¤.

#+begin_src elisp
  (use-package orderless
    :custom
    (completion-styles '(orderless basic)))
#+end_src

[[https://github.com/minad/consult][consult.el]]ë„ ì‚¬ìš©í•œë‹¤.

#+begin_src elisp
  (use-package consult
    :bind
    (("C-x b" . consult-buffer)
     ("M-g M-g" . consult-goto-line)))
#+end_src

minibuffer completionì´ ì‘ë™ ì¤‘ì¼ ë•Œ ë‚¨ì€ ì˜ì—­ì— ì¶”ê°€ ì •ë³´ë¥¼ í‘œì‹œí•˜ê²Œ í•˜ê¸° ìœ„í•´ [[https://github.com/minad/marginalia][marginalia.el]]ì„ ì‚¬ìš©í•œë‹¤.

#+begin_src elisp
  (use-package marginalia
    :init
    (marginalia-mode))
#+end_src

** COMMENT Helm
#+BEGIN_SRC emacs-lisp
  (use-package helm
    :ensure t
    :diminish helm-mode
    :init
    (progn
      (setq helm-M-x-requires-pattern nil
            helm-split-window-inside-p t ; open helm buffer inside
                                          ; current window, not occupy
                                          ; whole other window
            helm-move-to-line-cycle-in-source  t ; move to end or
                                          ; beginning of source
                                          ; when reaching top or
                                          ; bottom of source.
            helm-ff-search-library-in-sexp t ; search for library in
                                          ; `require' and
                                          ; `declare-function' sexp.
            helm-scroll-amount 8 ; scroll 8 lines other window using
                                          ; M-<next>/M-<prior>
            helm-ff-file-name-history-use-recentf t)
      (helm-mode))
    :bind (("C-c h" . helm-command-prefix)
           ("C-x C-f" . helm-find-files)
           ("C-x b" . helm-buffers-list)
           ("C-x C-b" . helm-buffers-list)
           ("C-x c y" . helm-yas-complete)
           ("C-x c Y" . helm-yas-create-snippet-on-region)
           ("M-y" . helm-show-kill-ring)
           ("M-x" . helm-M-x)
           ;; ("C-i" . helm-execute-persistent-action)
           ;; ("C-z" . helm-select-action)
           ))

  (use-package helm-descbinds
    :ensure t
    :defer 7
    :bind (("C-h b" . helm-descbinds)))
#+END_SRC

#+BEGIN_SRC emacs-lisp
  (use-package helm-swoop
    :ensure t
    :bind (("C-S-s" . helm-swoop)
           ("M-i" . helm-swoop)
           ("M-s s" . helm-swoop)
           ("M-s M-s" . helm-swoop)
           ("M-I" . helm-swoop-back-to-last-point)
           ("C-c M-i" . helm-multi-swoop)
           ("C-x M-i" . helm-multi-swoop-all)
           ("M-i" . helm-multi-swoop-all-from-helm-swoop)
           :map isearch-mode-map
           ("M-i" . helm-swoop-from-isearch)))
#+END_SRC

The default =C-x c= is quite close to =C-x C-c=, which quits Emacs.
Changed to =C-c h=. Note: We must set =C-c h= globally, because we
cannot change `helm-command-prefix-key' once `helm-config' is loaded.

#+BEGIN_SRC emacs-lisp
  (global-set-key (kbd "C-c h") 'helm-command-prefix)
  (global-unset-key (kbd "C-x c"))
#+END_SRC

** Others

text-modeë¥¼ ì‚¬ìš©í•  ê²½ìš° visual-line-modeë¥¼ í™œì„±í™” í•œë‹¤.

#+begin_src emacs-lisp
  (add-hook 'text-mode-hook #'visual-line-mode)
#+end_src

~auto-fill-mode~ ì—ì„œ ì‘ì„±í•œ plain text ë¬¸ì„œì˜ ê°œí–‰ë¬¸ìë¥¼ ì—†ì• ì£¼ëŠ” í•¨ìˆ˜ë¥¼ ì •ì˜í•œë‹¤. [[https://www.emacswiki.org/emacs/UnfillRegion][Emacs Wiki]]ì—ì„œ ê°€ì ¸ì™”ë‹¤. ì´ê²Œ ì™œ ê¸°ë³¸ ì½”ë“œë¡œ ì¶”ê°€ë˜ì–´ ìˆì§€ ì•Šì€ì§€ ëª¨ë¥´ê² ë‹¤.

#+begin_src emacs-lisp
  (defun unfill-region (beg end)
    "Unfill the region, joining text paragraphs into a single
      logical line.  This is useful, e.g., for use with
      `visual-line-mode'."
    (interactive "*r")
    (let ((fill-column (point-max)))
      (fill-region beg end)))
#+end_src

ì „ì²´ì ìœ¼ë¡œ ì“°ì´ëŠ” ë‹¨ì¶•í‚¤ë¥¼ ë“±ë¡í•œë‹¤.

#+begin_src emacs-lisp
  (global-set-key (kbd "C-M-Q") 'unfill-region)
  (global-set-key (kbd "M-u") 'upcase-dwim)
  (global-set-key (kbd "M-l") 'downcase-dwim)
  (global-set-key (kbd "M-c") 'capitalize-dwim)
#+end_src

#+begin_src emacs-lisp
  (use-package which-key
    :config (which-key-mode))
#+end_src

* Appearance

** Basic appearance
Hide =tool-bar= and =scroll-bar=.

#+BEGIN_SRC emacs-lisp
  (mapc
   (lambda (mode)
     (if (fboundp mode)
         (funcall mode -1)))
   '(tool-bar-mode scroll-bar-mode))
#+END_SRC

** doom-themes

#+BEGIN_SRC emacs-lisp
  (use-package doom-themes
    :init (load-theme 'doom-one t)
    :config
    (setq doom-themes-enable-bold t
          doom-themes-enable-italic t)
    (doom-themes-visual-bell-config)
    (doom-themes-neotree-config)
    (doom-themes-org-config))
#+END_SRC

** doom-modeline

ì•„ì´ì½˜ í°íŠ¸ë¥¼ ì“°ê¸° ìœ„í•´ì„œëŠ” [[https://github.com/rainstormstudio/nerd-icons.el][nerd-icons]]ì„ ì„¤ì¹˜í•´ì•¼ í•œë‹¤. ~M-x nerd-icons-install-fonts~ ëª…ë ¹ìœ¼ë¡œ ì„¤ì¹˜í•˜ë©´ ëœë‹¤.

#+begin_src elisp
  (use-package doom-modeline
    :hook (after-init . doom-modeline-mode)
    :config
    (setq doom-modeline-height 68)
    (setq doom-modeline-project-detection 'auto))
  ;; (setq doom-modeline-buffer-file-name-style 'auto)
  ;; (setq doom-modeline-icon t)
  ;; (setq doom-modeline-time-icon t))
#+end_src

** Font setting

#+BEGIN_SRC emacs-lisp
  ;; (require 'fontutil)

  (set-face-attribute 'default nil :font "Cascadia Code PL" :width 'condensed :weight 'semi-light)
  ;; (set-face-attribute 'default nil :font "Liberation Mono")
  ;; (set-face-attribute 'default nil :font "D2Coding ligature" :height 120)
  ;; (set-face-attribute 'default nil :font "Fira Code" :height 120)
  ;; (set-face-attribute 'default nil :font "Hack" :height 120)
  ;; (set-face-attribute 'default nil :font "Dejavu Sans Mono" :height 120)
  (set-fontset-font t '(#X1200 . #Xa95f) '("D2Coding" . "unicode-bmp"))
  (set-fontset-font t '(#Xac00 . #Xd7af) '("D2Coding" . "unicode-bmp"))

  (set-fontset-font t '(#X1100 . #X11ff) '("í•¨ì´ˆë¡¬ë‹ì›€" . "unicode-bmp"))
  (set-fontset-font t '(#Xa960 . #Xa97c) '("í•¨ì´ˆë¡¬ë‹ì›€" . "unicode-bmp"))
  (set-fontset-font t '(#Xd7b0 . #Xd7fb) '("í•¨ì´ˆë¡¬ë‹ì›€" . "unicode-bmp"))
  (set-fontset-font t '(#Xe0bc . #Xefff) '("í•¨ì´ˆë¡¬ë‹ì›€" . "unicode-bmp"))
  (set-fontset-font t '(#Xf100 . #Xf66e) '("í•¨ì´ˆë¡¬ë‹ì›€" . "unicode-bmp"))

  (set-fontset-font t 'han '("Noto Sans CJK KR" . "unicode-bmp"))
  (setq line-spacing 6)

  ;; (when-linux (fontutil/set-font "cascadia-14")))

  ;; (when-mac (fontutil/set-font "firacode-14")
  ;;           (setq-default line-spacing 3))

  ;; (when-windows (fontutil/set-font "d2coding-14")
  ;;       	(setq-default line-spacing 4)))

#+END_SRC

** line numbers

ë¼ì¸ë²ˆí˜¸ë¥¼ íŠ¹ì • ëª¨ë“œì— ë¶™ì¸ë‹¤.

#+begin_src emacs-lisp
  (use-package display-line-numbers-mode
    :ensure nil
    :hook (prog-mode text-mode conf-mode))
#+end_src


* Org Mode

#+begin_src emacs-lisp
  (use-package ob-http)
  (use-package ob-rust)
#+end_src

#+BEGIN_SRC emacs-lisp
  (defface org-block-begin-line
    '((t (:underline "#A7A6AA" :foreground "#008ED1" :background "#EAEAFF")))
    "Face used for the line delimiting the begin of source blocks.")

  (defface org-block-background
    '((t (:background "#FFFFEA")))
    "Face used for the source block background.")

  (defface org-block-end-line
    '((t (:overline "#A7A6AA" :foreground "#008ED1" :background "#EAEAFF")))
    "Face used for the line delimiting the end of source blocks.")

  (setq org-return-follow-link t
        org-startup-indented 't
        org-ditaa-jar-path "~/.emacs.d/ditaa.jar")

  (org-babel-do-load-languages 'org-babel-load-languages '((shell . t)
                                                             (python . t)
                                                             (ditaa . t)
                                                             (emacs-lisp . t)
                                                             (http . t)
                                                             (rust . t)))

  (setq org-agenda-files '("~/Dropbox/org/inbox.org"
                           "~/Dropbox/org/projects.org"
                           "~/Dropbox/org/repeaters.org"))

  (setq org-refile-targets
        '(("~/Dropbox/org/todo.org" :maxlevel . 3)
          ("~/Dropbox/org/projects.org" :maxlevel . 2)))

  (setq org-refile-use-outline-path 'file)
  (setq org-outline-path-complete-in-steps nil)
  (setq org-refile-allow-creating-parent-nodes 'confirm)

  (setq org-todo-keywords
        '((sequence "TODO(t)" "NEXT(n)" "|" "DONE(d)")
          (sequence "WAIT(w@/!)" "HOLD(h@/!)" "|" "CANCELED(c@/!)")))

  (setq org-capture-templates
        '(("t" "ğŸ“¥ Todo" entry (file+headline "~/Dropbox/org/inbox.org" "Todos")
           "* TODO %?\n  %i\n  %a")
          ("b" "ğŸ“‘ Bookmark" entry (file "~/Dropbox/org/bookmarks.org") 
           "* [[%^{ë§í¬ URL}][%^{ë§í¬ ì´ë¦„}]] %^g\n  %i\n" :prepend t)
          ("r" "To Read Item" entry (file+headline "~/Dropbox/org/inbox.org" "To Read Items") 
           "* %?\n  %T" :prepend t)))

  (setq org-agenda-custom-commands
        '((" " "Agenda"
           ((agenda ""
                    ((org-agenda-span 'day)))
            (todo "TODO"
                  ((org-agenda-overriding-header "Unscheduled tasks")
                   (org-agenda-files '("~/Dropbox/org/inbox.org"))
                   (org-agenda-skip-function '(org-agenda-skip-entry-if 'scheduled 'deadline))))
            (todo "TODO"
                  ((org-agenda-overriding-header "Unscheduled projects tasks")
                   (org-agenda-files '("~/Dropbox/org/projects.org"))
                   (org-agenda-skip-function '(org-agenda-skip-entry-if 'scheduled 'deadline))))))))

  (global-set-key (kbd "C-c c") #'org-capture)
  (global-set-key (kbd "C-c a") #'org-agenda)

  (defmacro func-ignore (fnc)
    "Return function that ignore its arguments and invokes FNC"
    `(lambda (&rest _rest)
       (funcall ,fnc)))

  (advice-add 'org-deadline :after (func-ignore #'org-save-all-org-buffers))
  (advice-add 'org-schedule :after (func-ignore #'org-save-all-org-buffers))
  (advice-add 'org-store-log-note :after (func-ignore #'org-save-all-org-buffers))
  (advice-add 'org-todo :after (func-ignore #'org-save-all-org-buffers))

  (require 'color)
  (set-face-attribute 'org-block nil :background
                      (color-darken-name
                       (face-attribute 'default :background) 3))

  (use-package org-bullets
    :requires org
    :hook (org-mode . (lambda () (org-bullets-mode 1))))

#+end_src


* COMMENT Old Configuration for Org

#+BEGIN_SRC emacs-lisp
  (use-package org
    :init (setq org-directory my-org-directory
                org-agenda-files my-org-agenda-files
                org-default-notes-file (concat org-directory "/notes.org")
                org-export-coding-system 'utf-8
                org-confirm-babel-evaluate nil)

    :mode (("\\.org\\'" . org-mode))

    :bind (("C-c l" . org-store-link)
           ("C-c c" . org-capture)
           ("C-c a" . org-agenda))

    :config
    (setq org-startup-indented 't
          org-ditaa-jar-path "~/.emacs.d/ditaa.jar")
    (org-babel-do-load-languages 'org-babel-load-languages '((shell . t)
                                                             (python . t)
                                                             (ditaa . t)
                                                             (emacs-lisp . t)
                                                             (http . t)
                                                             (rust . t)))
    (set-register ?l `(cons 'file ,(concat org-directory "/links.org")))
    ;; refer to http://orgmode.org/manual/Template-elements.html#Template-elements
    (setq org-capture-templates
          '(("l" "Link" entry (file+headline org-default-notes-file "Links") 
             "* %^L%? %^g" :prepend t)
            ("t" "To Do Item" entry (file+headline org-default-notes-file "To Do Items") 
             "* TODO %?\n  %T" :prepend t)
            ("r" "To Read Item" entry (file+headline org-default-notes-file "To Read Items") 
             "* %?\n  %T" :prepend t)))

    (setq org-refile-targets '((org-agenda-files :maxlevel . 3)))

    (setq org-feed-alist
          '(("Slashdot"
             "http://rss.slashdot.org/Slashdot/slashdot"
             (concat org-directory "/feeds.org")
             "Slashdot Entries")))

    (add-to-list 'org-latex-packages-alist '("" "listings" nil))
    (setq org-latex-listings t)
    (setq org-latex-listings-options '(("breaklines" "true")))
    (setq org-latex-minted-options '(("breaklines" "true")
                                   ("breakanywhere" "true")))

    (with-eval-after-load 'ox-latex
      (add-to-list 'org-latex-classes
                   '("xoblivoir"
                     "\\documentclass{xoblivoir}"))))

  (require 'color)
  (set-face-attribute 'org-block nil :background
                      (color-darken-name
                       (face-attribute 'default :background) 3))

  (use-package org-bullets
    :requires org
    :hook (org-mode . (lambda () (org-bullets-mode 1))))
#+END_SRC

í•œê¸€ì´ ì„ì¸ í…Œì´ë¸”ì´ ì‚ëš¤ë¹¼ëš¤ í•´ì§€ëŠ” ê²ƒì„ ë°”ë¡œì¡ê¸° ìœ„í•´ [[https://github.com/casouri/valign][ì´ íŒ¨í‚¤ì§€]]ë¥¼ ì‚¬ìš©í•œë‹¤.

#+begin_src emacs-lisp
  (use-package valign
      :requires org
      :hook org-mode)
#+end_src

This json babel taken from https://isamert.net/2022/01/04/dealing-with-apis-jsons-and-databases-in-org-mode.html.

#+begin_src emacs-lisp
  (defun org-babel-execute:json (body params)
    (let ((jq (cdr (assoc :jq params)))
          (node (cdr (assoc :node params))))
      (cond
       (jq
        (with-temp-buffer
          ;; Insert the JSON into the temp buffer
          (insert body)
          ;; Run jq command on the whole buffer, and replace the buffer
          ;; contents with the result returned from jq
          (shell-command-on-region (point-min) (point-max) (format "jq -r \"%s\"" jq) nil 't)
          ;; Return the contents of the temp buffer as the result
          (buffer-string)))
       (node
        (with-temp-buffer
          (insert (format "const it = %s;" body))
          (insert node)
          (shell-command-on-region (point-min) (point-max) "node -p" nil 't)
          (buffer-string))))))
#+end_src

Override line-numbers-mode in org-mode.

#+begin_src emacs-lisp
  (add-hook 'org-mode-hook (lambda () (display-line-numbers-mode 0)))
#+end_src

# ** org-roam

#    #+begin_src emacs-lisp
#      (use-package org-roam
#        :ensure t
#        :init (setq org-roam-v2-ack t)
#        :config (setq org-roam-directory "~/Dropbox/org-roam"))
     
#      (add-hook 'after-init-hook 'org-roam-mode)
#    #+end_src

* Programming

** Tree-Sitter

í˜„ì¬ emacs ìµœì‹  ë²„ì „(emacs-29) ê³µì‹ ë¦´ë¦¬ì¦ˆì—ì„œëŠ” tree-siterë¥¼ ê¸°ë³¸ì ìœ¼ë¡œ í¬í•¨í•˜ê³  ìˆì§€ ì•Šë‹¤. ê·¸ë˜ì„œ =--with-tree-sitter= ì˜µì…˜ì„ ì¶”ê°€í•˜ì—¬ ì†ŒìŠ¤ ë¹Œë“œí•´ì•¼ ì´ ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤(ë”ë¶ˆì–´ ì†ŒìŠ¤ ë¹Œë“œ í•˜ëŠ” ê¹€ì— ì‹¤í–‰ ì†ë„ë¥¼ ë†’ì´ê¸° ìœ„í•´ =--with-native-compilation== ì˜µì…˜ë„ ì¶”ê°€í•˜ëŠ” ê²ƒì´ ì¢‹ìŒ).

íŠ¹ì • ì–¸ì–´ ì½”ë”© ì‹œì— tree-sitterë¥¼ ì´ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” í•´ë‹¹ ì–¸ì–´ì˜ lagnuage grammerê°€ ë³„ë„ë¡œ í•„ìš”í•œë°, =M-x treesit-install-language-grammer= ëª…ë ¹ì„ ì´ìš©í•˜ì—¬ í•„ìš”í•œ íŒ¨í‚¤ì§€ë¥¼ ì„¤ì¹˜í•  ìˆ˜ ìˆë‹¤. ì„¤ì¹˜ ìœ„ì¹˜ëŠ” =~/.emacs.d/tree-sitter= ë¥¼ ì´ìš©í•œë‹¤. ì´ê²ƒë“¤ì€ ì†ŒìŠ¤ë¡œ ë¶€í„° ë™ì  ë¼ì´ë¸ŒëŸ¬ë¦¬ë¡œ ë¹Œë“œí•˜ì—¬ ì‚¬ìš©í•˜ë¯€ë¡œ ì‹œìŠ¤í…œì— ë¹Œë“œíˆ´ì´ ë¯¸ë¦¬ ì„¤ì¹˜ë˜ì–´ ìˆì–´ì•¼ í•œë‹¤.

í˜„ì¬ ì‚¬ìš©í•˜ëŠ” ì£¼ìš” ì–¸ì–´ëŠ” ì•„ë˜ì™€ ê°™ë‹¤.

#+begin_src elisp
  (setq treesit-language-source-alist
     '((bash "https://github.com/tree-sitter/tree-sitter-bash")
       (cmake "https://github.com/uyha/tree-sitter-cmake")
       (css "https://github.com/tree-sitter/tree-sitter-css")
       (elisp "https://github.com/Wilfred/tree-sitter-elisp")
       (go "https://github.com/tree-sitter/tree-sitter-go")
       (html "https://github.com/tree-sitter/tree-sitter-html")
       (javascript "https://github.com/tree-sitter/tree-sitter-javascript" "master" "src")
       (json "https://github.com/tree-sitter/tree-sitter-json")
       (make "https://github.com/alemuller/tree-sitter-make")
       (markdown "https://github.com/ikatyang/tree-sitter-markdown")
       (python "https://github.com/tree-sitter/tree-sitter-python")
       (toml "https://github.com/tree-sitter/tree-sitter-toml")
       (tsx "https://github.com/tree-sitter/tree-sitter-typescript" "master" "tsx/src")
       (typescript "https://github.com/tree-sitter/tree-sitter-typescript" "master" "typescript/src")
       (yaml "https://github.com/ikatyang/tree-sitter-yaml")))
#+end_src

ielmì—ì„œ ~(mapc #'treesit-install-language-grammar (mapcar #'car treesit-language-source-alist))~ ì™€ ê°™ì€ ëª…ë ¹ìœ¼ë¡œ ì´ ëª©ë¡ì— ìˆëŠ” ëª¨ë“ˆë“¤ì„ í•œë²ˆì— ì„¤ì¹˜í•  ìˆ˜ ìˆë‹¤.

** projectile

~projectile-indexing-method~ ë¥¼ =alien= ìœ¼ë¡œ ì§€ì •í•˜ì—¬ Windowsì—ì„œë„ ì´ ë°©ë²•ì„ ì“°ë„ë¡ ê°•ì œí•œë‹¤. ìì„¸í•œ ë‚´ìš©ì€ [[https://github.com/bbatsov/projectile/issues/1183][ì´ìŠˆ]]ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆë‹¤. ë©”ë‰´ì–¼ì€ [[https://docs.projectile.mx/projectile/index.html][ì—¬ê¸°]]ì—ì„œ ë³¼ ìˆ˜ ìˆë‹¤.

#+BEGIN_SRC emacs-lisp
  (use-package projectile
    :after
    (helm)
    :bind-keymap
    ("C-c p" . projectile-command-map)
    :init
    (projectile-mode +1)
    :config
    (use-package helm-projectile
      :config (helm-projectile-on))
    :custom
    (projectile-enable-caching t)
    (projectile-indexing-method 'alien)
    (projectile-completion-system 'helm))
#+END_SRC


** magit

This is an awesome plugin as git client.

#+BEGIN_SRC emacs-lisp
  (use-package magit
    :commands (magit-init
               magit-status)
    :bind ("C-x g" . magit-status))
#+END_SRC

** A hook for compilation buffer using ansi-color

[[https://emacs.stackexchange.com/questions/8135/why-does-compilation-buffer-show-control-characters]["Why does *compilation* buffer show control characters?"]] ì°¸ì¡°í•¨.

Note: ~ansi-color-compilation-filter~ is built in since emacs 28.1.

#+begin_src emacs-lisp
  (require 'ansi-color)
  (add-hook 'compilation-filter-hook 'ansi-color-compilation-filter)
#+end_src

** Coding convention

#+begin_src emacs-lisp
  (use-package editorconfig
    :ensure t
    :config (editorconfig-mode 1))
#+end_src

** diff-hl
#+BEGIN_SRC emacs-lisp
  (use-package diff-hl
    :ensure t
    :init (global-diff-hl-mode)
    :config
    (add-hook 'magit-post-refresh-hook #'diff-hl-magit-post-refresh))
#+END_SRC

** flycheck
#+BEGIN_SRC emacs-lisp
  (use-package flycheck
    :hook (after-init . global-flycheck-mode)
    :config
    (setq flycheck-check-syntax-automatically '(save idle-change mode-enabled)))
#+END_SRC

** Yasnippet
#+BEGIN_SRC emacs-lisp
  (use-package yasnippet
    :defer 5
    :diminish yas-minor-mode
    :config (yas-global-mode 1))

  (use-package yasnippet-snippets
    :ensure t
    :after yasnippet)
#+END_SRC


** Eldoc

#+begin_src emacs-lisp
  (use-package eldoc
    :hook (emacs-lisp-mode ielm-mode rust-mode rust-ts-mode))
#+end_src

#+begin_src emacs-lisp
  (setq eldoc-echo-area-prefer-doc-buffer t)
#+end_src


** COMMENT lsp-mode

emacs 29.1 ë¶€í„°ëŠ” eglotì´ ê¸°ë³¸ìœ¼ë¡œ í¬í•¨ëœë‹¤. ì‚¬ìš©í•´ë³´ë‹ˆ ì›ì¸ì„ ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë™ì‘ì´ ì ê³  lsp ì„œë²„ì™€ ì—°ê²° ì•ˆì •ì„±ì´ ë‚«ë‹¤. ê·¸ë˜ì„œ lsp-modeëŠ” í›„ìˆœìœ„ë¡œ ë°”ê¾¼ë‹¤.

sh-modeì—ì„œ í™œì„±í™”ë˜ë ¤ë©´ [[https://github.com/mads-hartmann/bash-language-server][bash-language-server]]ë¥¼ ë¨¼ì € ì„¤ì¹˜í•´ì•¼í•œë‹¤. ì¶”ê°€ ì„¤ëª…ì€ [[https://emacs-lsp.github.io/lsp-mode/page/lsp-bash/][ì—¬ê¸°]].

#+begin_src emacs-lisp
  (setq lsp-keymap-prefix "C-c l")

  (defun bj/lsp-mode-setup ()
    (setq lsp-headerline-breadcrumb-segments '(path-up-to-project file symbols))
    (lsp-headerline-breadcrumb-mode))

  (use-package lsp-mode
    :init (setq lsp-keymap-prefix "C-c l")
    ;; :hook (((c-mode) . lsp-mode)
    ;;        (lsp-mode . bj/lsp-mode-setup)
    ;;        (lsp-mode . lsp-enable-which-key-integration)
    ;;        )
    ;; :custom (lsp-enable-on-type-formatting nil)
    :custom
    ;; (lsp-rust-analyzer-server-command '("~/.cargo/bin/rust-analyzer"))
    (lsp-eldoc-render-all t)
    (lsp-rust-analyzer-cargo-watch-command "clippy")

    (lsp-idle-delay 0.6)
    (lsp-rust-analyzer-server-display-inlay-hints t)
    :config
    (add-hook 'lsp-mode-hook 'lsp-ui-mode)
    :commands lsp lsp-deferred
    )

  (use-package lsp-ui
    :commands lsp-ui-mode
    :hook (lsp-mode . lsp-ui-mode)
    :config
    ;; (setq lsp-ui-sideline-enable nil)
    ;; (setq lsp-ui-sideline-show-hover nil)
    ;; (lsp-ui-doc-enable nil)
    :custom
    (lsp-ui-peek-always-show nil)
    (lsp-ui-sideline-show-hover nil)
    (lsp-ui-doc-enable t)
    (lsp-ui-imenu-enable t))

  (use-package company-lsp
    :commands company-lsp
    :config (push 'company-lsp company-backends))

  (setq lsp-prefer-capf t)
  (setq lsp-completion-provider :capf)
  (setq lsp-completion-enable t)

  (use-package helm-lsp
    :commands helm-lsp-workspace-symbol)

  (use-package lsp-treemacs
    :after lsp-mode
    :commands lsp-treemacs-errors-list)
#+end_src

#+begin_src emacs-lisp
  (setq company-transformers nil
  company-lsp-async t
  company-lsp-cache-candidates nil)
#+end_src

** COMMENT company

#+begin_src emacs-lisp
  (use-package company
    :after lsp-mode
    :hook (lsp-mode . company-mode)
    :bind (("C-M-i" . company-complete)
           :map company-active-map
           ("C-n" . company-select-next)
           ("C-p" . company-select-previous)
           ("<tab>" . company-complete-common-or-cycle)
           :map lsp-mode-map
           ("<tab>" . company-indent-or-complete-common)
           :map company-search-map
           ("C-n" . company-select-next)
           ("C-p" . company-select-previous)))
#+end_src


** C/C++

c-modeë‚˜ c++-mode ì—ì„œ lsp ì„œë²„ë¡œ cclsë¥¼ ì‚¬ìš©í•œë‹¤. clangdë„ ê´œì°®ì€ ê²ƒ ê°™ìœ¼ë‚˜ ì„ë² ë””ë“œ ì†ŒìŠ¤íŠ¸ë¦¬ì—ì„œ ì‘ì—…í•  ë•Œ ë„¤ë¹„ê²Œì´ì…˜ ë¬¸ì œê°€ ìˆë‹¤.

#+begin_src emacs-lisp
  (use-package ccls
    :hook ((c-mode c++-mode objc-mode sh-mode) .
           (lambda () (require 'ccls) (eglot-ensure)))
    :config (setq ccls-executable "~/.local/bin/ccls"))
#+end_src

#+BEGIN_SRC emacs-lisp
  (c-add-style "my-c-style"
               '("linux"
                 (c-basic-offset . 4)))

  (setq c-default-style "my-c-style")
#+END_SRC

ë¨¼ì € llvmì„ ì„¤ì¹˜í•´ì•¼í•œë‹¤.

#+BEGIN_SRC emacs-lisp
  ;; (use-package clang-format
  ;;   :ensure t
  ;;   :bind (:map c-mode-base-map
  ;;               ("C-M-\\" . clang-format-region)))
#+END_SRC

*** tree-sitter

#+begin_src elisp
  (add-to-list 'major-mode-remap-alist '(c-mode . c-ts-mode))
  (add-to-list 'major-mode-remap-alist '(c++-mode . c++-ts-mode))
  (add-to-list 'major-mode-remap-alist
               '(c-or-c++-mode . c-or-c++-ts-mode))
#+end_src

** Python

#+BEGIN_SRC emacs-lisp
  (use-package python
    :mode ("\\.py\\'" . python-mode)
    :interpreter ("python3" . python-mode)
    :config
    (add-hook 'python-mode-hook
              (function (lambda ()
                          (setq indent-tabs-mode nil
                                tab-width 4
                                electric-indent-inhibit t)))))

  (use-package elpy
    :defer t
    :init
    (advice-add 'python-mode :before 'elpy-enable)
    :config
    (setq elpy-rpc-python-command "python3")
    (setq python-shell-interpreter "python3")
    (setq python-shell-interpreter-args "-i")
    :bind (:map elpy-mode-map
                ("M-." . elpy-goto-definition)
                ("M-," . pop-tag-mark)))

  (use-package pip-requirements
    :config
    (add-hook 'pip-requirements-mode-hook #'pip-requirements-auto-complete-setup))

  (use-package py-autopep8)
#+END_SRC

** Rust

#+begin_src emacs-lisp
  ;; (setq exec-path (append exec-path '("~/.cargo/bin")))

  ;; (use-package rust-mode
  ;;   :init (add-hook 'rust-mode-hook (lambda () (setq indent-tabs-mode nil)))

  ;;   :bind (:map rust-mode-map
  ;; 	      ("C-c r" . rust-run)
  ;; 	      ("C-c t" . rust-test)
  ;; 	      ("C-c b" . cargo-process-build))
  ;;   :config (setq rust-format-on-save t))

  ;; (use-package cargo
  ;;   :hook (rust-mode . cargo-minor-mode))

  (use-package rustic
    :ensure
    :bind (:map rustic-mode-map
                ("M-j" . lsp-ui-imenu)
                ("M-?" . lsp-find-references)
                ("C-c C-c l" . flycheck-list-errors)
                ("C-c C-c a" . lsp-execute-code-action)
                ("C-c C-c r" . lsp-rename)
                ("C-c C-c q" . lsp-workspace-restart)
                ("C-c C-c Q" . lsp-workspace-shutdown)
                ("C-c C-c s" . lsp-rust-analyzer-status)
                ("C-c C-c e" . lsp-rust-analyzer-expand-macro)
                ("C-c C-c d" . dap-hydra)
                ("C-c C-c h" . lsp-ui-doc-glance))
    :config
    ;; uncomment for less flashiness
    ;; (setq lsp-eldoc-hook nil)
    ;; (setq lsp-enable-symbol-highlighting nil)
    ;; (setq lsp-signature-auto-activate nil)

    ;; comment to disable rustfmt on save
    (setq rustic-format-on-save t)
    (add-hook 'rustic-mode-hook 'rk/rustic-mode-hook))

  (defun rk/rustic-mode-hook ()
    ;; so that run C-c C-c C-r works without having to confirm, but don't try to
    ;; save rust buffers that are not file visiting. Once
    ;; https://github.com/brotzeit/rustic/issues/253 has been resolved this should
    ;; no longer be necessary.
    (when buffer-file-name
      (setq-local buffer-save-without-query t)))
#+end_src

#+begin_src elisp
  (use-package rust-playground)
  (use-package toml-mode)
#+end_src


** Arduino

#+BEGIN_SRC emacs-lisp
  (use-package arduino-mode)
#+END_SRC

org-mode structure templateì— pythonì„ ì¶”ê°€í•œë‹¤.

#+BEGIN_SRC emacs-lisp
  (if (boundp 'org-structure-template-alist)
      (add-to-list 'org-structure-template-alist '("p" . "src python")))
#+END_SRC


** Emacs Lisp

#+begin_src elisp
  (use-package elisp-mode
    :ensure nil
    :init
    (add-hook 'emacs-lisp-mode-hook (lambda () (setq indent-tabs-mode nil)))
    :bind (:map emacs-lisp-mode-map
                ("<f6>" . eval-buffer)
                ("M-<f6>" . emacs-lisp-byte-compile-and-load)
                ("<return>" . newline-and-indent)))

  (use-package paredit
    :hook ((lisp-mode emacs-lisp-mode)))

  (use-package rainbow-delimiters
    :hook ((lisp-mode emacs-lisp-mode)))
#+end_src


** Configurations for Qt5

#+BEGIN_SRC emacs-lisp
  (use-package qml-mode)
#+END_SRC

** YAML
#+BEGIN_SRC emacs-lisp
  (use-package yaml-mode)
#+END_SRC

** Conf

#+begin_src elisp
  (use-package conf-mode
    :config 
    (add-hook 'conf-mode-hook
              (lambda ()
                (setq indent-line-function #'insert-tab
                      indent-tabs-mode     t))))
#+end_src

* Docker

#+BEGIN_SRC emacs-lisp
  (use-package dockerfile-mode
    :mode ("Dockerfile\\'" . dockerfile-mode))
#+END_SRC

#+BEGIN_SRC emacs-lisp
  (use-package docker-compose-mode)
#+END_SRC

#+BEGIN_SRC emacs-lisp
  (use-package docker
    :bind ("C-c d" . docker))
#+END_SRC

* graphviz-dot-mode
#+BEGIN_SRC emacs-lisp
  (use-package graphviz-dot-mode
    :mode ("\\.dot\\'" . graphviz-dot-mode)
    :init
    (autoload 'graphviz-dot-mode "graphviz-dot-mode" "graphviz-dot Editing Mode" t))
#+END_SRC

* gnuplot-mode
#+BEGIN_SRC emacs-lisp
  (use-package gnuplot-mode
    :mode ("\\.plt\\'" . gnuplot-mode)
    :config (when-windows (setq gnuplot-program "c:/pkg/gnuplot/bin/gnuplot.exe")))
#+END_SRC

* markdown-mode
#+BEGIN_SRC emacs-lisp
  (use-package markdown-mode
    :mode ("\\.md\\'" . markdown-mode)
    :init
    (autoload 'markdown-mode "markdown-mode" "Major mode for editing Markdown files" t))
#+END_SRC

* [[http://jblevins.org/projects/deft/][Deft]]
#+BEGIN_SRC emacs-lisp
  (use-package deft
    :ensure t
    :bind ("<f9>" . deft)
    :config (setq deft-extensions '("org" "md" "txt")
                  deft-directory "~/Dropbox/wiki"
                  deft-auto-save-interval 0
                  deft-text-mode 'org-mode))
#+END_SRC
* Tools

** COMMENT Managing mails with mu4e

#+begin_src emacs-lisp
  (require 'mu4e)
  (require 'mu4e-contrib)

  (setq mu4e-mu-binary "~/.local/bin/mu")
  (setq mu4e-change-filenames-when-moving t)

  (setq mu4e-update-interval (* 10 60))
  (setq mu4e-get-mail-command "mbsync -a")
  (setq mu4e-maildir "~/Mail")

  (setq mu4e-drafts-folder "/[Gmail].Drafts")
  (setq mu4e-sent-folder "/[Gmail].Sent Mail")
  (setq mu4e-refile-folder "/[Gmail].All Mail")
  (setq mu4e-trash-folder "/[Gmail].Trash")

  (setq mu4e-maildir-shortcuts
        '(("/Inbox" . ?i)
          ("/[Gmail].Sent Mail" . ?s)
          ("/[Gmail].Trash" . ?t)
          ("/[Gmail].Draft" . ?d)
          ("/[Gmail].All Mail" . ?a)))
#+end_src

#+begin_src emacs-lisp
  (use-package org-mime)
#+end_src

** Google Translater

#+BEGIN_SRC emacs-lisp
  (use-package google-translate
    :ensure t
    :bind ("M-o t" . google-translate-at-point)
    ("M-o T" . google-translate-at-point-reverse)
    :custom
    (google-translate-default-source-language "en")
    (google-translate-default-target-language "ko"))
#+END_SRC

** rfc-mode

#+begin_src emacs-lisp
  (use-package rfc-mode
    :ensure t
    :init (setq rfc-mode-directory (expand-file-name "~/Dropbox/resources/rfc/")))
#+end_src


